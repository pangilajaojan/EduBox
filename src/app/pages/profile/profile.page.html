<!-- Background Pattern -->
<div class="bg-pattern">
  <div class="circle circle-1"></div>
  <div class="circle circle-2"></div>
  <div class="circle circle-3"></div>
</div>

<div class="profile-container">
  <!-- Loading State -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="spinner"></div>
  </div>

  <!-- Profile Header -->
  <header class="profile-header">
    <div class="profile-content">
      <div class="profile-avatar" (click)="changeAvatar()">
        {{ getInitials(profileData.displayName) || '👤' }}
      </div>
      <div class="profile-name">{{ profileData.displayName || 'EduBox User' }}</div>
      <div class="profile-role">
        Advanced Student •
        {{ profileData?.skills ? profileData.skills.split(',')[0] : 'Coding Enthusiast' }}
      </div>
      <div class="profile-stats">
        <div class="stat-item">
          <div class="stat-number">{{ getTotalXP() }}</div>
          <div class="stat-label">XP Points</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ getCompletedCount() }}</div>
          <div class="stat-label">Completed</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ unlockedAchievementsCount }}</div>
          <div class="stat-label">Badges</div>
        </div>
      </div>
    </div>
  </header>

  <!-- Level Progress -->
  <section class="level-progress">
    <div class="level-header">
      <div class="level-title">Level {{ getLevel() }}</div>
      <div class="level-badge">{{ getLevelBadge() }}</div>
    </div>
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="getLevelProgress()"></div>
      </div>
    </div>
    <div class="progress-text">
      <span>{{ getCurrentXP() }} / {{ getNextLevelXP() }} XP</span>
      <span>{{ getXPToNextLevel() }} XP to Level {{ getLevel() + 1 }}</span>
    </div>
  </section>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Quick Actions -->
    <div class="quick-actions">
      <div class="quick-action" (click)="editProfile()">
        <div class="quick-action-icon">✏️</div>
        <div class="quick-action-title">Edit Profile</div>
        <div class="quick-action-desc">Update info & preferences</div>
      </div>
      <div class="quick-action" (click)="viewCertificates()">
        <div class="quick-action-icon">🏆</div>
        <div class="quick-action-title">Certificates</div>
        <div class="quick-action-desc">View achievements</div>
      </div>
    </div>

    <!-- Achievements -->
    <div class="section">
      <h3 class="section-title">🏅 My Badges</h3>
      <div class="achievement-grid">
        <div class="achievement-item"
             *ngFor="let achievement of achievements"
             [class.locked]="!achievement?.unlocked"
             (click)="viewAchievement(achievement)">
          <span class="achievement-icon">
            {{ achievement?.unlocked ? (achievement?.emoji || '🏆') : '🔒' }}
          </span>
          <div class="achievement-title">{{ achievement?.title || 'Unknown Badge' }}</div>
          <div class="achievement-desc">{{ achievement?.description || 'No description available' }}</div>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="section">
      <h3 class="section-title">📈 Recent Activity</h3>
      <div class="activity-list">
        <div class="activity-item" *ngFor="let activity of recentActivity">
          <div class="activity-header">
            <div class="activity-icon">{{ activity?.emoji || '✅' }}</div>
            <div class="activity-info">
              <div class="activity-title">{{ activity?.action || 'No Action' }}</div>
              <div class="activity-desc">{{ activity?.item || 'No Item' }}</div>
            </div>
            <div class="activity-time">{{ activity?.time || '' }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings -->
    <div class="section">
      <h3 class="section-title">⚙️ Settings</h3>
      <div class="settings-list">
        <div class="settings-item" (click)="openSettings('account')">
          <div class="settings-icon account">👤</div>
          <div class="settings-info">
            <div class="settings-title">Account Settings</div>
            <div class="settings-desc">Manage your account information</div>
          </div>
          <span class="settings-arrow">›</span>
        </div>
        <div class="settings-item" (click)="openSettings('notifications')">
          <div class="settings-icon notification">🔔</div>
          <div class="settings-info">
            <div class="settings-title">Notifications</div>
            <div class="settings-desc">Customize notification preferences</div>
          </div>
          <span class="settings-arrow">›</span>
        </div>
        <div class="settings-item" (click)="openSettings('privacy')">
          <div class="settings-icon privacy">🔒</div>
          <div class="settings-info">
            <div class="settings-title">Privacy & Security</div>
            <div class="settings-desc">Control your privacy settings</div>
          </div>
          <span class="settings-arrow">›</span>
        </div>
        <div class="settings-item" (click)="openSettings('help')">
          <div class="settings-icon help">❓</div>
          <div class="settings-info">
            <div class="settings-title">Help & Support</div>
            <div class="settings-desc">Get help and contact support</div>
          </div>
          <span class="settings-arrow">›</span>
        </div>
        <div class="settings-item" (click)="openSettings('about')">
          <div class="settings-icon about">ℹ️</div>
          <div class="settings-info">
            <div class="settings-title">About EduBox</div>
            <div class="settings-desc">App version and information</div>
          </div>
          <span class="settings-arrow">›</span>
        </div>
      </div>
    </div>
  </main>

  <!-- Bottom Navigation -->
  <footer class="bottom-nav">
    <div class="nav-items">
      <div class="nav-item" [class.active]="currentTab === 'home'" (click)="navigateTo('home')">
        <div class="nav-icon">🏠</div>
        <div class="nav-label">Beranda</div>
      </div>
      <div class="nav-item" [class.active]="currentTab === 'workspace'" (click)="navigateTo('workspace')">
        <div class="nav-icon">🎮</div>
        <div class="nav-label">3D Space</div>
      </div>
      <div class="nav-item" [class.active]="currentTab === 'coding'" (click)="navigateTo('coding')">
        <div class="nav-icon">💻</div>
        <div class="nav-label">Coding</div>
      </div>
      <div class="nav-item" [class.active]="currentTab === 'modules'" (click)="navigateTo('modules')">
        <div class="nav-icon">📚</div>
        <div class="nav-label">Modul</div>
      </div>
      <div class="nav-item active">
        <div class="nav-icon">👤</div>
        <div class="nav-label">Profile</div>
      </div>
    </div>
  </footer>

  <!-- Achievement Modal -->
  <div class="modal" role="dialog" aria-labelledby="achievement-title" [class.show]="showAchievementModal">
    <div class="modal-content">
      <div class="modal-icon">{{ selectedAchievement?.emoji || '🏆' }}</div>
      <div class="modal-title">{{ selectedAchievement?.title || 'Achievement Unlocked!' }}</div>
      <div class="modal-desc">{{ selectedAchievement?.description || 'Congratulations on your achievement!' }}</div>
      <button class="modal-btn" (click)="closeModal()">Awesome!</button>
    </div>
  </div>
</div>
